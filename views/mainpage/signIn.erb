<!DOCTYPE HTML>
<html>
<head>
<%== renderPartial("htmlHeader");%>
</head>
<body>

<div id="loginWindow" class="mini-window" title="<%== UI("signIn") %>" 
   showModal="true" showCloseButton="false">

    <div id="loginForm" style="padding:15px;padding-top:10px;">
        <table >
            <tr>
                <td nowrap="nowrap"><label for="username$text"><%== UI("account") %>:</label></td>
                <td>
                    <input id="username" name="username" class="mini-textbox" required="true" style="width:150px;"/>
                </td>    
            </tr>
            <tr>
                <td nowrap="nowrap"><label for="password$text"><%== UI("pswd") %>:</label></td>
                <td>
                    <input id="password" name="password" class="mini-password" required="true" style="width:150px;" onenter="onLoginClick"/>
                    
                </td>
            </tr>
            <tr>
				<td style="padding-top:5px;" colspan="2" align="center">
				<div><%== UI("defaultAccoutAndPasswordNote") %></div>
				<!-- <a href="forgetPassword" ><%== UI("forgetPassword") %>?</a> -->
				</td>
			</tr>            
            <tr>
			     <td style="padding-top:5px;" colspan="2" align="center">
                    <a onclick="onLoginClick" class="mini-button" "><%== UI("signInSystem") %></a>
					<a onclick="onResetClick" class="mini-button" "><%== UI("resetFrom") %></a>
                </td>
			</tr>
			
        </table>
    </div>

</div>

   <script src="/js/hmac-sha512.js" type="text/javascript"></script>
    <script type="text/javascript">
        mini.parse();

        var loginWindow = mini.get("loginWindow");
        loginWindow.show();

        function onLoginClick(e) {
            var form = new mini.Form("#loginWindow");

            form.validate();
            if (form.isValid() == false) return;
			
			var data = form.getData();
			var hash=CryptoJS.HmacSHA512(data.password,data.username).toString(CryptoJS.enc.Hex);
			data.password=hash;
		
            $.ajax({
				  type: 'POST',
				  url: 'logIn',
				  data: data,
				  success: function(text){
				    try{eval(text);}
                    catch(exception){ 
						mini.showMessageBox({
							showHeader: false,
							buttons: ['ok'],
							message: exception,
							iconCls: 'mini-messagebox-error'
						});
					}
				  }
     	    });
		}
        function onResetClick(e) {
            var form = new mini.Form("#loginWindow");
            form.clear();
        }
    </script>

</body>
</html>